generator client {
  provider = "prisma-client"
  // le client sera g√©n√©r√© dans /generated/prisma
  output   = "../generated/prisma"
}

datasource db {
  provider = "sqlite"
  // URL dans prisma.config.ts via env("DATABASE_URL")
}

/// Un utilisateur de l'application.
/// Pour l'instant il n'y aura que toi (Paul),
/// mais ce mod√®le permet d'en g√©rer plusieurs plus tard.
model User {
  id           String   @id @default(cuid())
  email        String   @unique
  passwordHash String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  weekPlans       WeekPlan[]
  sessionHistory  SessionHistory[]

  name        String?
  sessions        Session[] @relation("UserSessions")
}


model Exercise {
  id          String   @id @default(cuid())
  name        String
  slug        String?  @unique   // <- optionnel, donc migrable m√™me avec des lignes existantes
  muscleGroup String?           // ex: "Dos", "Pecs", "Jambes", etc.

  sessionExercises SessionExercise[]
}



/// Une s√©ance (dos, jambes, circuit pec/triceps, etc.)
model Session {
  id        String   @id @default(cuid())

  userId    String?
  user      User?    @relation("UserSessions", fields: [userId], references: [id])

  slug      String   
  name      String
  type      String
  estimatedDurationMinutes Int?

  // relations existantes
  items     SessionExercise[]
  weekDays  WeekDay[]
  history   SessionHistory[]

  @@index([userId])
  // un m√™me utilisateur ne peut pas avoir deux fois le m√™me slug
  @@unique([userId, slug])
}



/// Un exercice √† l'int√©rieur d'une s√©ance
model SessionExercise {
  id          String   @id @default(cuid())
  sessionId   String
  exerciseId  String
  order       Int
  sets        Int
  reps        String
  repsType    String   // <= ce champ-l√†
  restSeconds Int?

  session     Session  @relation(fields: [sessionId], references: [id])
  exercise    Exercise @relation(fields: [exerciseId], references: [id])
}


/// Un planning type pour une semaine
model WeekPlan {
  id   String @id @default(cuid())
  name String

  userId String
  user   User   @relation(fields: [userId], references: [id])

  days WeekDay[]

  // üî• nouveaux champs
  isActive     Boolean @default(true)
  templateType String? // "beginner" | "intermediate" | "advanced" | "custom"

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

/// Un jour dans le planning
model WeekDay {
  id         String @id @default(cuid())
  weekPlanId String
  day        String // "monday" | "tuesday" | "wednesday"...

  isRest            Boolean @default(false)
  warmupMinutes     Int?
  warmupDescription String?

  sessionId String?
  session   Session? @relation(fields: [sessionId], references: [id])

  weekPlan WeekPlan @relation(fields: [weekPlanId], references: [id])
}

/// Historique des s√©ances effectu√©es
model SessionHistory {
  id                 String   @id @default(cuid())
  sessionId          String
  finishedAt         DateTime // timestamp de fin
  durationSeconds    Int // dur√©e totale
  totalCompletedSets Int // nb de s√©ries/blocs valid√©s

  // üîó appartenance √† un utilisateur
  userId String
  user   User   @relation(fields: [userId], references: [id])

  session Session @relation(fields: [sessionId], references: [id])
}
