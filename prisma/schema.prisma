generator client {
  provider = "prisma-client"
  // le client sera gÃ©nÃ©rÃ© dans /generated/prisma
  output   = "../generated/prisma"
}

datasource db {
  provider = "sqlite"
  // URL dans prisma.config.ts via env("DATABASE_URL")
}

/// Un utilisateur de l'application.
/// Pour l'instant il n'y aura que toi (Paul),
/// mais ce modÃ¨le permet d'en gÃ©rer plusieurs plus tard.
model User {
  id    String  @id @default(cuid())
  email String  @unique
  name  String?

  // ğŸ” Auth
  passwordHash  String    @default("") // on met une string vide pour l'instant
  emailVerified DateTime?

  // ğŸ” tracking
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  // relations existantes
  weekPlans WeekPlan[]
  history   SessionHistory[]
}

model Exercise {
  id          String   @id @default(cuid())
  name        String
  slug        String?  @unique   // <- optionnel, donc migrable mÃªme avec des lignes existantes
  muscleGroup String?           // ex: "Dos", "Pecs", "Jambes", etc.

  sessionExercises SessionExercise[]
}



/// Une sÃ©ance (dos, jambes, circuit pec/triceps, etc.)
model Session {
  id                          String @id @default(cuid())
  slug                        String @unique
  name                        String
  type                        String // "classic" | "circuit"
  estimatedDurationMinutes    Int?
  rounds                      Int? // pour les circuits
  restBetweenExercisesSeconds Int? // repos entre exos (circuit)
  restBetweenRoundsSeconds    Int? // repos entre tours (circuit)

  items   SessionExercise[]
  days    WeekDay[]
  history SessionHistory[]
}

/// Un exercice Ã  l'intÃ©rieur d'une sÃ©ance
model SessionExercise {
  id         String @id @default(cuid())
  sessionId  String
  exerciseId String

  order Int

  // Pour les "sÃ©ances classiques"
  sets Int? // nombre de sÃ©ries (si applicable)

  // ReprÃ©sentation des rÃ©pÃ©titions :
  repsType  String // "reps" | "time"
  repsValue Int? // ex: 8 (reps) ou 30 (secondes)
  repsText  String? // cas particuliers type "max", "5-8", etc.

  restSeconds Int? // repos aprÃ¨s cet exo / cette sÃ©rie
  note        String?

  session  Session  @relation(fields: [sessionId], references: [id])
  exercise Exercise @relation(fields: [exerciseId], references: [id])
}

/// Un planning type pour une semaine
model WeekPlan {
  id   String @id @default(cuid())
  name String

  userId String
  user   User   @relation(fields: [userId], references: [id])

  days WeekDay[]

  // ğŸ”¥ nouveaux champs
  isActive     Boolean @default(true)
  templateType String? // "beginner" | "intermediate" | "advanced" | "custom"

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

/// Un jour dans le planning
model WeekDay {
  id         String @id @default(cuid())
  weekPlanId String
  day        String // "monday" | "tuesday" | "wednesday"...

  isRest            Boolean @default(false)
  warmupMinutes     Int?
  warmupDescription String?

  sessionId String?
  session   Session? @relation(fields: [sessionId], references: [id])

  weekPlan WeekPlan @relation(fields: [weekPlanId], references: [id])
}

/// Historique des sÃ©ances effectuÃ©es
model SessionHistory {
  id                 String   @id @default(cuid())
  sessionId          String
  finishedAt         DateTime // timestamp de fin
  durationSeconds    Int // durÃ©e totale
  totalCompletedSets Int // nb de sÃ©ries/blocs validÃ©s

  // ğŸ”— appartenance Ã  un utilisateur
  userId String
  user   User   @relation(fields: [userId], references: [id])

  session Session @relation(fields: [sessionId], references: [id])
}
